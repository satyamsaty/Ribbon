---
  - name: remove  the invalid key 
    shell: ssh-keygen -R "mgt0IPAddress_STANDBY"
    register: b
    failed_when: b.rc not in (0,255)
  - name: remove  the invalid key
    shell: ssh-keygen -R "mgt0IPAddress_ACTIVE"
    register: b
    failed_when: b.rc not in (0,255)

#  - name:
#    shell: scp -o  "stricthostkeychecking no" -i $HOME/cloud_ats.key -P 2024 $HOME/oamrollover.sh root@{{ mgt0IPAddress_STANDBY }}:/root
#  - name: Running oam rollover
#    shell: ssh -p 2024 -o  "stricthostkeychecking no" -i $HOME/cloud_ats.key root@{{ mgt0IPAddress_STANDBY }} "expect /root/oamrollover.sh"
  - name: Switchover by killing CHM process on Active Instance
    shell:
       "ps -few | grep -i chm |grep -i sonusad | grep -v grep | awk '{print $2}'|xargs kill"
#  - name: 
#    wait_for: timeout=10
#  - name: waiting for service to come after switchover
#    shell: sh /home/ansible/process.sh {{ mgt0IPAddress_STANDBY }}
#    register: b
#    failed_when: b.rc not in (0,1)
#  - name:
#    wait_for: timeout=30
#  - name: checking Sync status
#    shell: ssh -o UserKnownHostsFile=/dev/null -o  "stricthostkeychecking no" -p 2024 -i $HOME/cloud_ats.key "root@{{ mgt0IPAddress_STANDBY }}" "sh /opt/sonus/sbx/scripts/swinfo.sh"
#    register: b
#  - debug: var=b.stdout_lines
#  - name: sleep for 30 seconds and continue with play
#    wait_for:
#       timeout: 30

#  - name: Sync status after active and standby spawned successfully
#    shell:
#      " /opt/sonus/sbx/scripts/swinfo.sh"
#    register: a
#  - debug: var=a.stdout_lines


 # - name: Switchback by Killing CHM process on current Active Instance installed role as Standby
 #   shell: 
 #      "ps -few | grep -i chm |grep -i sonusad | grep -v grep | awk '{print \$2}'|xargs kill"
 # - name:
 #   wait_for: timeout=10
 # - name: waiting for System to come  after switchback
 #   shell: sh /home/ansible/process.sh  {{ mgt0IPAddress_ACTIVE }}
 #   register: b
 #   failed_when: b.rc not in (0,1)
 # - name:
 #   wait_for: timeout=30
 # - name: checking Sync status after switchback 
 #   shell: ssh -o UserKnownHostsFile=/dev/null -o  "stricthostkeychecking no" -p 2024 -i $HOME/cloud_ats.key "root@{{ mgt0IPAddress_ACTIVE }}" "sh /opt/sonus/sbx/scripts/swinfo.sh"
 #   register: b
 # - debug: var=b.stdout_lines
#  - name: Final sync status
#    wait_for: timeout=10
#  - name: checking Sync status after switchback
#    shell: ssh -o UserKnownHostsFile=/dev/null -o  "stricthostkeychecking no" -p 2024 -i $HOME/cloud_ats.key "root@{{ mgt0IPAddress_ACTIVE }}" "sh /opt/sonus/sbx/scripts/swinfo.sh"
#    register: b
#  - debug: var=b.stdout_lines


 

 
