#  - name: to push license in active node after upgrade
#    shell: sh /home/ansible/license_push_cloud.sh {{mgt0IPAddress_ACTIVE}} null
#    delegate_to: localhost
#    register: command_result
#  - name: License pushed on active box
#    shell: curl -kisu 'admin:admin' -X GET https://{{mgt0IPAddress_ACTIVE}}/api/operational/system/licenseInfo | grep -wE '(usageLimit|inUse)' | head -2
#    register: b
#  - debug: var=b.stdout_lines
  - name: Management IP
    command: "echo {{ item.mgt0ipaddress }}"
    register: result
    loop: "{{ isbc_distributed_nodes }}"
    loop_control:
       label: "{{ item.mgt0ipaddress }}"
  - debug:
      var: result
    no_log: True
  - name: pushing license in active node after rebuilding it .
    script: "{{ LicenseScript_Path }} {{ result.results[0].stdout }} null "
    register: result
    failed_when:
         - result.rc == 1
         - '"license bundle b1 already exists" not in result.stdout'
  - debug: var=result

  - name: License pushed on boxes
    shell: curl -kisu 'admin:admin' -X GET https://{{item.mgt0ipaddress}}/api/operational/system/licenseInfo | grep -wE '(usageLimit|inUse)' | head -2
    register: b
    loop: "{{ isbc_distributed_nodes }}"
  - debug:
      msg: "{{ item.stdout_lines }}"
    loop: "{{ b.results }}"
    loop_control:
      label: "{{ item.stdout_lines }}"


